/**
 * DK Videos
 *
 * @package		DK Videos
 * @version		Version 1.0b1
 * @author		Benjamin David
 * @copyright	Copyright (c) 2012 - DUKT
 * @link		http://dukt.net/dk-videos/
 *
 *//*
var Dukt_video = {
	site_id : 0,
	ajax_endpoint : ajaxurl
};
*/$.fn.spin=function(e){this.each(function(){var t=$(this),n=t.data();if(n.spinner){n.spinner.stop();delete n.spinner}e!==!1&&(n.spinner=(new Spinner($.extend({color:t.css("color")},e))).spin(this))});return this};$(document).ready(function(){var e={lines:13,length:4,width:2,radius:4,corners:1,rotate:0,color:"#000",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"7px",left:"6px"};$(".dk-videos-status .spin").spin(e);var e={lines:13,length:3,width:2,radius:4,corners:1,rotate:0,color:"#000",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"0",left:"0"};$(".dkv-search .spin").spin(e)});var dk_videos_box={},dk_videos_ajax_stack=[];jQuery(document).ready(function(e){dk_videos_box={init:function(){console.log("boo");dk_videos_box.lightbox.init()},box:!1,utils:{current_service:function(){return e(e(".videoplayer-accounts > ul > li.selected > a").get(0)).data("service")}}};dk_videos_box.lightbox={init:function(){var t=e('<div class="videoplayer-overlay loading"><div class="spin"></div></div>');e("body").append(t);e(".videoplayer-overlay").live("click",function(){dk_videos_box.lightbox.hide();console.log("test")});var n={lines:13,length:5,width:2,radius:5,corners:1,rotate:0,color:"#fff",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"0",left:"0"};e(".videoplayer-overlay .spin").spin(n);dk_videos_box.lightbox.resize();e(window).resize(function(){dk_videos_box.lightbox.resize()})},show:function(){e(".videoplayer-overlay").css("display","block");e(".dukt-videos-wrapper").css("display","block");e(".videoplayer-videos li").each(function(){if(e(this).hasClass("selected")){var t={method:"box_preview",service:dk_videos_box.utils.current_service(),site_id:Dk_videos.site_id,video_page:e(this).data("video-page"),autoplay:0,rel:0};e(".videoplayer-preview").data("video-page",e(this).data("video-page"));e(".videoplayer-controls").css("display","block");dk_videos_box.browser.go(t,"preview",function(){e(".videoplayer-controls").css("display","block");dk_videos_box.box.resize()})}})},hide:function(){e(".videoplayer-overlay").css("display","none");e(".dukt-videos-wrapper").css("display","none");e(".videoplayer-preview-inject").html("");dk_videos_box.browser.abort("preview")},resize:function(){var t=e(window).width(),n=e(window).height(),r=e(".dukt-videos-wrapper").outerWidth(),i=e(".dukt-videos-wrapper").outerHeight(),s=(t-r)/2,o=(n-i)/2;e(".dukt-videos-wrapper").css({left:s,top:o});e(".videoplayer-overlay").css({width:t,height:n})}};dk_videos_box.ajax_stack={init:function(){e(".dk-videos-status .reload").live("click",function(){console.log("reload all");e(".videoplayer-accounts ul ul > li > a").each(function(t,n){var r=e(n).data("listing"),i=e(n).data("service"),s=e(n).data("method");data={method:s,site_id:Dk_videos.site_id,service:i};var o=!1;e(".dkv-listing-view").each(function(t,n){e(n).data("listing")==r&&e(n).data("service")==i&&(o=e(n))});var u=e(n).data("service")+e(n).data("listing");dk_videos_box.ajax_stack.add(u,function(){return e.ajax({url:Dk_videos.ajax_endpoint,type:"post",data:data,beforeSend:function(){e(".dkv-videos",o).addClass("dkv-loading")},success:function(t){dk_videos_box.ajax_stack.remove(u);e(".dkv-videos-inject",o).html(t)}})})})})},add:function(e,t){console.log("add",e);dk_videos_ajax_stack[e]=t();dk_videos_box.ajax_stack.updateStatus()},remove:function(e){console.log("remove",e);for(key in dk_videos_ajax_stack)key==e&&delete dk_videos_ajax_stack[key];dk_videos_box.ajax_stack.updateStatus()},updateStatus:function(){dk_videos_box.ajax_stack.count()>0?e(".dk-videos-status").addClass("loading"):e(".dk-videos-status").removeClass("loading")},count:function(){var e=0;for(key in dk_videos_ajax_stack)e++;return e}};dk_videos_box.listings={reload:function(t,n,r){console.log("reloadx",t,n,r);var i=n+t;dk_videos_box.ajax_stack.add(i,function(){data={method:r,site_id:Dk_videos.site_id,service:n};var s=!1;e(".dkv-listing-view").each(function(r,i){e(i).data("listing")==t&&e(i).data("service")==n&&(s=e(i))});return e.ajax({url:Dk_videos.ajax_endpoint,type:"post",data:data,beforeSend:function(){},success:function(t){dk_videos_box.ajax_stack.remove(i);e(".dkv-videos-inject",s).html(t)}})})}};dk_videos_box.box={init:function(t){dk_videos_box.box.resize();dk_videos_box.box.accounts();dk_videos_box.box.videos();dk_videos_box.search.init();dk_videos_box.ajax_stack.init();e(window).resize(function(){dk_videos_box.box.resize()});var n={lines:13,length:4,width:2,radius:4,corners:1,rotate:0,color:"#000",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"7px",left:"6px"};e(".dk-videos-status .spin").spin(n);typeof t!="undefined"&&t()},resize:function(){var t=e(".videoplayer-box").parent().outerHeight(),n=e(window).width(),r=0,i=e(".splitter-top-left").outerHeight(),s=e(".splitter-bottom-left").outerHeight(),o=e(".videoplayer-preview-video").outerWidth(),u=1280,a=720,f=o*a/u;f=Math.round(f);var l=t-r;console.log(l);var c=l-i-s,h=l-i-f-s,p=f*100/(f+h);console.log("percent",p);if(p>60){f=60*(f+h)/100;f=Math.round(f)}h=l-i-f-s;var d=l-i-s;console.log(l,i,f,s);console.log(h);e(".videoplayer-box").css("height",l);e(".videoplayer-accounts").css("height",l);e(".videoplayer-listings").css("height",l);e(".videoplayer-preview").css("height",l);e(".videoplayer-preview-video, .videoplayer-preview-video iframe").css("height",f);e(".videoplayer-fullscreen .videoplayer-preview-video, .videoplayer-fullscreen .videoplayer-preview-video iframe").css("height",d);e(".videoplayer-preview-inject").css("height",c);e(".videoplayer-preview-description").css("height",h);e(".dkv-videos").css("height",c);dk_videos_box.lightbox.resize()}};dk_videos_box.box.accounts=function(){e(".videoplayer-close").live("click",function(){dk_videos_box.lightbox.hide()});e(".videoplayer-accounts > ul > li > a").live("click",function(){if(e(this).parent().hasClass("selected"))return!1;var t=e(this);current_method=e(".videoplayer-accounts ul ul > li a.selected").data("method");e(".videoplayer-accounts > ul > li").removeClass("selected");e(".videoplayer-accounts ul ul > li a").removeClass("selected");e(this).parent().addClass("selected");method_found=!1;e(this).parent().find("ul > li a").each(function(){if(e(this).data("method")==current_method){method_found=!0;e(this).trigger("click")}});if(!method_found){e(this).parent().find("ul > li:first-child a").addClass("selected");q=e(e(".dkv-search input")[0]).attr("value");var n={method:"service_search",service:dk_videos_box.utils.current_service(),site_id:Dk_videos.site_id,q:q};dk_videos_box.browser.go(n,"videos")}e(".videoplayer-accounts > ul > li").each(function(){t.hasClass("selected")||e(this).parent().find("ul").slideUp({easing:"easeOutCubic",duration:400})});e(this).parent().find("ul").slideDown({easing:"easeOutCubic",duration:400})});e(".videoplayer-accounts ul ul > li > a").each(function(t,n){var r=e(n).data("listing"),i=e(n).data("service"),s=e(n).data("method");data={method:s,site_id:Dk_videos.site_id,service:i};var o=!1;e(".dkv-listing-view").each(function(t,n){e(n).data("listing")==r&&e(n).data("service")==i&&(o=e(n))});var u=e(n).data("service")+e(n).data("listing");dk_videos_box.ajax_stack.add(u,function(){return e.ajax({url:Dk_videos.ajax_endpoint,type:"post",data:data,beforeSend:function(){e(".dkv-videos",o).addClass("dkv-loading")},success:function(t){dk_videos_box.ajax_stack.remove(u);e(".dkv-videos-inject",o).html(t)}})})});e(".videoplayer-accounts ul ul > li > a").live("click",function(){if(e(this).hasClass("selected")){var t=e(this).data("listing"),n=e(this).data("service"),r=e(this).data("method");dk_videos_box.listings.reload(t,n,r)}e(".videoplayer-accounts ul ul > li > a").removeClass("selected");e(this).addClass("selected");var t=e(this).data("listing"),n=e(this).data("service"),r=e(this).data("method"),i=!1;e(".dkv-listing-view").css("display","none");e(".dkv-listing-view").each(function(r,s){if(e(s).data("listing")==t&&e(s).data("service")==n){i=e(s);i.css("display","block")}})});e(".videoplayer-accounts li ul").css("display","none");e(".videoplayer-services > li:first-child > a").trigger("click");e(".videoplayer-accounts > ul > li").each(function(){if(e(this).hasClass("selected")){e(this).find("ul").slideDown({easing:"easeOutCubic",duration:400});e(this).find("ul li:first-child a").trigger("click")}})};dk_videos_box.box.videos=function(){e(".dkv-videos li").live("click",function(){if(e(this).hasClass("videoplayer-videos-more"))return!1;e(".videoplayer-preview-inject").html("");e(".dkv-videos li").removeClass("selected");e(this).addClass("selected");var t={method:"box_preview",service:dk_videos_box.utils.current_service(),site_id:Dk_videos.site_id,video_page:e(this).data("video-page"),autoplay:1,rel:0};e(".videoplayer-preview").data("video-page",e(this).data("video-page"));e(".videoplayer-controls").css("display","block");dk_videos_box.browser.go(t,"preview",function(){e(".videoplayer-controls").css("display","block");dk_videos_box.box.resize()})});e(".videoplayer-preview-favorite").live("click",function(){favorite_enabled=!1;if(e(this).hasClass("videoplayer-preview-favorite-selected"))e(this).removeClass("videoplayer-preview-favorite-selected");else{e(this).addClass("videoplayer-preview-favorite-selected");favorite_enabled=!0}var t=e(this).data("service");console.log("--service",t);var n={action:"dukt_videos",method:"favorite",service:t,site_id:Dk_videos.site_id,video_page:e(".videoplayer-preview").data("video-page"),favorite_enabled:favorite_enabled},r="service_favorites";e.ajax({url:Dk_videos.ajax_endpoint,type:"post",data:n,success:function(e){dk_videos_box.listings.reload("favorites",t,r)}})});e(".videoplayer-preview-fullscreen").live("click",function(){if(e(".videoplayer-box").hasClass("videoplayer-fullscreen")){e(".videoplayer-box").removeClass("videoplayer-fullscreen");dk_videos_box.box.resize()}else{e(".videoplayer-box").addClass("videoplayer-fullscreen");dk_videos_box.box.resize()}});e(".videoplayer-videos-more").live("click",function(){if(e(this).find(".videoplayer-videos-more-btn").css("display")!="none"){e(this).find(".videoplayer-videos-more-btn").css("display","none");e(this).find(".videoplayer-videos-more-loading").css("display","inline");var t=e(".dkv-search input").attr("value"),n={action:"dukt_videos",method:e(".videoplayer-services > li.selected li a.selected").data("method"),service:dk_videos_box.utils.current_service(),site_id:Dk_videos.site_id,q:t,page:e(this).data("next-page")};e.ajax({url:Dk_videos.ajax_endpoint,type:"post",data:n,beforeSend:function(){},success:function(t){e(".videoplayer-videos-more").remove();var n=e(".videoplayer-videos ul").html(),r=n+t;e(".videoplayer-videos ul").html(r)}})}});e(e(".videoplayer-videos").get(0)).scroll(function(t){scrollDifference=e(this).get(0).scrollHeight-e(this).scrollTop();scrollDifference==e(this).height()&&e(".videoplayer-videos-more").trigger("click")})};dk_videos_box.browser={current_request:[],go:function(t,n,r){t.action="dukt_videos";dk_videos_box.browser.current_request[n]=e.ajax({url:Dk_videos.ajax_endpoint,type:"post",data:t,beforeSend:function(){e(".videoplayer-"+n).addClass("videoplayer-frame-loading")},success:function(t){dk_videos_box.browser.current_request[n]=!1;e(".videoplayer-"+n+"-inject").html(t);e(".videoplayer-"+n).removeClass("videoplayer-frame-loading");e(".dkv-search").removeClass("loading");if(dk_videos_box.search.timer){clearTimeout(dk_videos_box.search.timer);dk_videos_box.search.timer=!1}typeof r=="function"&&r()}})},abort:function(e){console.log("abort");if(typeof dk_videos_box.browser.current_request[e]!="undefined"){if(dk_videos_box.browser.current_request[e]!=0){dk_videos_box.browser.current_request[e].abort();dk_videos_box.browser.current_request[e]=!1}}else dk_videos_box.browser.current_request[e]=!1}};dk_videos_box.search={textFocus:!1,init:function(){var t={lines:13,length:3,width:2,radius:4,corners:1,rotate:0,color:"#000",speed:2.2,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"0",left:"0"};e(".dkv-search .spin").spin(t);e(".videoplayer-search-reset").live("click",function(){e(".dkv-search input").attr("value","");e(this).css("display","none");e(".dkv-search input").trigger("keyup")});dk_videos_box.search.timer=!1;var n=!1;e(".dkv-search input").live("keydown",function(e){e.keyCode==91&&(n=!0)}).live("keyup",function(t){e(".videoplayer-accounts > ul > li.selected ul li a").removeClass("selected");e(".videoplayer-accounts > ul > li.selected ul li:first-child a").addClass("selected");var r=e(this),i=r.attr("value");i!==""?e(".videoplayer-search-reset").css("display","block"):e(".videoplayer-search-reset").css("display","none");if(n==1&&t.keyCode!=91){n=!1;return!1}switch(t.keyCode){case 91:n=!1;return!1;case 18:case 16:case 37:case 38:case 39:case 40:return!1}dk_videos_box.search.timer&&clearTimeout(dk_videos_box.search.timer);dk_videos_box.search.timer||e(".dkv-search").addClass("loading");var s=e(this).data("listing"),o=e(this).data("service"),u=!1;e(".dkv-listing-view").each(function(t,n){e(n).data("listing")==s&&e(n).data("service")==o&&(u=e(n))});console.log(this,s,o);dk_videos_box.search.timer=setTimeout(function(){var t={method:"service_search",service:dk_videos_box.utils.current_service(),site_id:Dk_videos.site_id,q:i};e.ajax({url:Dk_videos.ajax_endpoint,type:"post",data:t,beforeSend:function(){e(".dkv-search").addClass("loading");e(".dkv-videos",u).addClass("dkv-loading")},success:function(t){e(".dkv-videos-inject",u).html(t);e(".dkv-search").removeClass("loading")}})},500)})}};e(document).ready(function(){dk_videos_box.init()})});